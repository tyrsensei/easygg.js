<link rel="import" href="/assets/polymer/polymer.html">
<link rel="import" href="/elements/socket-io.html">

<dom-module id="games-list">
    <template>
        <paper-listbox>
            <template is="dom-repeat" items="[[_toArray(games)]]">
                    <paper-item>
                        <paper-item-body>[[item.value.name]]</paper-item-body>
                        <socket-io emit="game tables" target-element="paper-icon-button" target-event="tap" namespace="[[item.name]]">
                            <paper-icon-button icon="icons:send" alt="Rejoindre"></paper-icon-button>
                        </socket-io>
                    </paper-item>
            </template>
        </paper-listbox>
    </template>

    <script>
        Polymer({
            is: 'games-list',
            properties: {
                games: {
                    type: Object,
                    notify: true
                }
            },
            _toArray: function(obj) {
                return Object.keys(obj).map(function(key) {
                    return {
                        name: key,
                        value: obj[key]
                    };
                });
            }
        });
    </script>
</dom-module>

<dom-module id="user-form">
    <template>
        <paper-card heading="Joueur">
            <div class="card-content">
                <paper-input label="Nom" value="{{userData.name::input}}"></paper-input>
            </div>
            <div class="card-actions horizontal layout center-justified">
                <socket-io emit="user" target-element="paper-button" target-event="tap" emit-data='{{userData}}'>
                    <paper-button raised>Valider</paper-button>
                </socket-io>
            </div>
        </paper-card>
    </template>

    <script>
        Polymer({
            is: 'user-form',
            properties: {
                userData: {
                    type: Object,
                    value: {name: 'tyrsensei'},
                    notify: true
                }
            }
        });
    </script>
</dom-module>

<dom-module id="tables-list">
    <template>
        <paper-header-panel>
            <paper-toolbar>
                <div class="title">Liste des parties</div>
                <paper-icon-button icon="icons:add" on-tap="openCreateDialog"></paper-icon-button>
            </paper-toolbar>
            <div>
                <paper-listbox>
                    <template is="dom-repeat" items="[[_toArray(tables)]]">
                        <paper-item>
                            <paper-item-body>[[item.value.name]]</paper-item-body>
                            <socket-io emit="join table" target-element="paper-icon-button" target-event="tap" namespace="/test" emit-data$="[[item.name]]">
                                <paper-icon-button icon="icons:send" alt="Rejoindre"></paper-icon-button>
                            </socket-io>
                        </paper-item>
                    </template>
                </paper-listbox>
            </div>
        </paper-header-panel>
        <paper-dialog>
            <h2>Informations de la partie</h2>
            <paper-input label="Nom de la partie" value="{{createData.name::input}}"></paper-input>
            <div class="buttons">
                <socket-io emit="new game" namespace="/test" target-element="paper-button" target-event="tap" emit-data='{{createData}}'>
                    <paper-button raised><iron-icon icon="icons:add"></iron-icon> Cr√©er</paper-button>
                </socket-io>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'tables-list',
            properties: {
                tables: {
                    type: Object,
                    notify: true
                },
                createData: {
                    type: Object,
                    value: {name: "Ma Partie"},
                    notify: true
                }
            },
            _toArray: function(obj) {
                return Object.keys(obj).map(function(key) {
                    return {
                        name: key,
                        value: obj[key]
                    };
                });
            },
            _debug : function() {
                console.log(this._toArray(this.tables));
            },
            openCreateDialog: function() {
                this.querySelector('paper-dialog').open();
            }
        });
    </script>
</dom-module>
