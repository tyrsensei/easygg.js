doctype html
html
  head
    title Test
    meta(name='viewport', content='width=device-width, initial-scale=1')
    script(src='/assets/webcomponentsjs/webcomponents-lite.min.js')

    link(rel='import', href='/assets/iron-flex-layout/iron-flex-layout.html')
    link(rel='import', href='/assets/iron-icon/iron-icon.html')
    link(rel='import', href='/assets/iron-icons/iron-icons.html')
    link(rel='import', href='/assets/iron-icons/social-icons.html')
    link(rel='import', href='/assets/iron-pages/iron-pages.html')
    link(rel='import', href='/assets/paper-button/paper-button.html')
    link(rel='import', href='/assets/paper-card/paper-card.html')
    link(rel='import', href='/assets/paper-dialog/paper-dialog.html')
    link(rel='import', href='/assets/paper-drawer-panel/paper-drawer-panel.html')
    link(rel='import', href='/assets/paper-header-panel/paper-header-panel.html')
    link(rel='import', href='/assets/paper-icon-button/paper-icon-button.html')
    link(rel='import', href='/assets/paper-input/paper-input.html')
    link(rel='import', href='/assets/paper-item/paper-icon-item.html')
    link(rel='import', href='/assets/paper-item/paper-item-body.html')
    link(rel='import', href='/assets/paper-item/paper-item.html')
    link(rel='import', href='/assets/paper-listbox/paper-listbox.html')
    link(rel='import', href='/assets/paper-material/paper-material.html')
    link(rel='import', href='/assets/paper-styles/paper-styles.html')
    link(rel='import', href='/assets/paper-toolbar/paper-toolbar.html')

    link(rel='import', href='/elements/socket-io.html')
    link(rel='import', href='/elements/easygg.html')

    link(rel='stylesheet', href='/css/style.css')

    style(is='custom-style').
      body {
        @apply(--paper-font-common-base);
      }
      paper-material {
        padding:15px;
      }
      #main {
        padding-top: 10px;
        width:80%;
      }

  body(unresolved, class='fullbleed layout vertical')

    socket-io(namespace='/')
    socket-io(receive='connected users', receive-callback='refreshConnectedUsers')
    socket-io(receive='games list', receive-callback='refreshGameList')
    socket-io(receive='user updated', receive-callback='chooseGame')
    socket-io(receive='game tables', receive-callback='changeGame', namespace='/test')
    socket-io(emit='games list')
    socket-io(emit='connected users', interval='60000')

    paper-drawer-panel(force-narrow)
      paper-header-panel(drawer, mode='waterfall')
        paper-toolbar
          div(class='title') Liste des jeux
        div
          games-list
      paper-header-panel(mode='waterfall', main)
        paper-toolbar
          paper-icon-button(icon='menu', paper-drawer-toggle)
          div(class='title') EasyGG
          paper-icon-button(icon='social:person', id='profile')
          iron-icon(icon='social:people')
          span &nbsp;
            span(id='num-users') 0
        div(class='vertical layout center')
          iron-pages(id='main', attr-for-selected='ns', selected='user')
            block content

    script.
      function addToDebug(data) {
        console.log(data);
      }
      function refreshGameList(data) {
        document.querySelector('games-list').games = data.games;
      }
      function refreshConnectedUsers(data) {
        document.querySelector('#num-users').textContent = data.number;
      }
      function changeGame(data) {
        var pages = document.querySelector('iron-pages#main');
        pages.select(data.game);
        pages.selectedItem.querySelector('tables-list').tables = data.tables;
        document.querySelector('paper-drawer-panel').closeDrawer();
      }
      function chooseGame() {
        document.querySelector('paper-drawer-panel').openDrawer();
      }
      document.querySelector('paper-icon-button#profile').addEventListener('tap', function() {
        document.querySelector('iron-pages#main').select('user');
      });